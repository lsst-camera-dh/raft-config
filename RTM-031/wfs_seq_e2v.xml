<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!-- *********************************************************************** -->
<!-- wfs_seq_e2v.xml                                                         -->
<!-- xml sequencer configuration file for use with the fpga on the LSSTcam   -->
<!-- curvature wavefront sensor readout electronics board: WREB.             -->
<!--                                                                         -->
<!-- Author: P. Doherty                                                      -->
<!-- Date: March 17, 2015                                                    -->
<!-- *********************************************************************** -->
<sequencer>
    <sequencer-config>
    <!-- ******************************************************************* -->
    <!-- Sequencer configuration includes definitions of the parameters and  -->
    <!-- the channels used in the design. The 'channels' are the bits used   -->
    <!-- to make the timing patterns.                                        -->
    <!-- ******************************************************************* -->
        <parameters>
        
            <!-- *********************************************************** -->
            <!-- ImageCount : the number times to read the CCD               -->
            <!--                                                             -->
            <parameter id="ImageCount">
                <fullname>Number times to read the CCD</fullname>
                <value>4000</value>
            </parameter>

            <!-- *********************************************************** -->
            <!-- Format Parameters                                           -->
            <!-- Parameters that define the section of the CCD to be read    -->
            <!-- A single subarray is supported. Image data will include     -->      
            <!-- the specified pixels form every segment of the device in    -->
            <!-- the same location.                                          -->
            <!--                                                             -->
            <!-- SegRows : the number of rows in each segment of the CCD     -->
            <!-- SegColumns : number of columns in each segment of the CCD   -->
            <!-- PreRows : Number of rows to discard before subarray read    -->
            <!-- PreColumns : Number of cols to discard before subarray read -->
            <!-- ReadRows : Number of rows in each segment to read          -->
            <!-- ReadColumns : Number of columns in each segment to read     -->
            <!-- PostRows : Number of rows to discard after subarray read    -->
            <!-- PostColumns : Number of columns to discard after subarray   -->
            <!-- *********************************************************** -->
               
            <parameter id="SegRows">
                <fullname>Number of rows of the sensor</fullname>
                <value>512</value>
            </parameter>
            
            <parameter id="SegColumns">
                <fullname>Number of columns of the sensor</fullname>
                <value>512</value>
            </parameter>           
             
            <parameter id="PreRows">
                <fullname>Number of rows of the sensor</fullname>
                <value>0</value>
            </parameter>
            
            <parameter id="PreColumns">
                <fullname>Number of columns of the sensor</fullname>
                <value>0</value>
            </parameter>    
            
            <parameter id="ReadRows">
                <fullname>Number of rows of the sensor</fullname>
                <value>256</value>
            </parameter>
            
            <parameter id="ReadColumns">
                <fullname>Number of columns in each segment to read</fullname>
                <value>128</value>
            </parameter>           

            <parameter id="PostRows">
                <fullname>Number of rows to discard after subarray read </fullname>
                <value>0</value>
            </parameter>
            
            <parameter id="PostColumns">
                <fullname>Number of columns to discard after subarray</fullname>
                <value>0</value>
            </parameter>           

            <!-- *********************************************************** -->
            <!-- Timing Parameters                                           -->
            <!-- Parameters that define ...                                  -->
            <!--                                                             -->
            <!--                                                             -->            
            <!-- ParDelay : delay between each state in a parallel shift     -->
            <!--                                                             -->
            <!-- SerDelay : delay between each state in a serial shift       -->
            <!--   Used for serial shifts, but not during pixel readout,     -->
            <!--   see ReadDelayN and RampDelay for pixel readout timing     -->
            <!--                                                             -->
            <!-- RampDelay : duration of Ramp Up and Ramp Down periods       -->
            <!--                                                             -->
            <!-- ReadDelayN : delay between states in a pixel readout        -->
            <!-- Note:for Ramp Up and Ramp Down delay, RampDelay is used     -->
            <!--                                                             -->          
            <!-- *********************************************************** -->

            <parameter id="ParDelay">
                <fullname>Parallel Clock State Duration</fullname>
                <value>3 us</value>
            </parameter>

            <parameter id="SerDelay">
                <fullname>Parallel Clock State Duration</fullname>
                <value>3 us</value>
            </parameter>

            <parameter id="RampDelay">
                <fullname>Integrator Dwell Time</fullname>
                <value>500 ns</value>
            </parameter>

            <parameter id="ReadDelay1">
                <fullname>Pixel Read Delay 1</fullname>
                <value>100 ns</value>
            </parameter>
            <parameter id="ReadDelay2">
                <fullname>Clock period</fullname>
                <value>100 ns</value>
            </parameter>
            <parameter id="ReadDelay3">
                <fullname>Clock period</fullname>
                <value>100 ns</value>
            </parameter>
            <parameter id="ReadDelay4">
                <fullname>Clock period</fullname>
                <value>100 ns</value>
            </parameter>
            <parameter id="ReadDelay5">
                <fullname>Clock period</fullname>
                <value>100 ns</value>
            </parameter>
            <parameter id="ReadDelay6">
                <fullname>Clock period</fullname>
                <value>50 ns</value>
            </parameter>
            <parameter id="ReadDelay7">
                <fullname>Clock period</fullname>
                <value>50 ns</value>
            </parameter>
            <parameter id="ReadDelay8">
                <fullname>Clock period</fullname>
                <value>50 ns</value>
            </parameter>
            <parameter id="ReadDelay9">
                <fullname>Clock period</fullname>
                <value>50 ns</value>
            </parameter>
            <parameter id="ReadDelay10">
                <fullname>Clock period</fullname>
                <value>50 ns</value>
            </parameter>
            <parameter id="ReadDelay11">
                <fullname>Clock period</fullname>
                <value>50 ns</value>
            </parameter>
            <parameter id="ReadDelay12">
                <fullname>Clock period</fullname>
                <value>100 ns</value>
            </parameter>
            <parameter id="ReadDelay13">
                <fullname>Clock period</fullname>
                <value>80 ns</value>
            </parameter>

        </parameters>

        <channels>
        <!-- *************************************************************** -->
        <!-- Channels are the bit assignments for the sequence engine.       -->
        <!--                                                                 -->
        <!-- Channels include:                                               -->
        <!--      bit 0:  RU  : APSIC Ramp Up                                -->
        <!--      bit 1:  RD  : APSIC Ramp Down                              -->     
        <!--      bit 2:  RST : ASPIC Integratror Reset                      --> 
        <!--      bit 3:  CL  : ASPIC Input Clamp                            -->
        <!--      bit 4:  R1  : CCD Output Register (Serial) Phase 1         -->
        <!--      bit 5:  R2  : CCD Output Register (Serial) Phase 2         -->
        <!--      bit 6:  R3  : CCD Output Register (Serial) Phase 3         -->
        <!--      bit 7:  RG  : CCD Reset Gate Clock                         -->
        <!--      bit 8:  P1  : CCD Parallel Clock Phase 1                   -->
        <!--      bit 9:  P2  : CCD Parallel Clock Phase 2                   -->
        <!--      bit 10: P3  : CCD Parallel Clock Phase 3                   -->
        <!--      bit 11: P4  : CCD Parallel Clock Phase 4                   -->
        <!--      bit 12: SPL : ADC sampling signal                          -->
        <!--      bit 13: SOI : Start of image                               -->
        <!--      bit 14: EOI : End of image                                 -->
        <!--      bit 15: RDP : Calibration pulse on reset drain             -->
        <!--                                                                 -->
        <!-- *************************************************************** -->
            
            <channel id="RU">
                <fullname>ASPIC ramp-up integration</fullname>
                <value>0</value>
            </channel>
            <channel id="RD">
                <fullname>ASPIC ramp-down integration</fullname>
                <value>1</value>
            </channel>
            <channel id="RST">
                <fullname>ASPIC integrator reset</fullname>
                <value>2</value>
            </channel>
            <channel id="CL">
                <fullname>ASPIC clamp</fullname>
                <value>3</value>
            </channel>
            <channel id="R1">
                <fullname>Serial clock 1</fullname>
                <value>4</value>
            </channel>
            <channel id="R2">
                <fullname>Serial clock 2</fullname>
                <value>5</value>
            </channel>
            <channel id="R3">
                <fullname>Serial clock 3</fullname>
                <value>6</value>
            </channel>
            <channel id="RG">
                <fullname>Serial reset clock</fullname>
                <value>7</value>
            </channel>
            <channel id="P1">
                <fullname>Parallel clock 1</fullname>
                <value>8</value>
            </channel>
            <channel id="P2">
                <fullname>Parallel clock 2</fullname>
                <value>9</value>
            </channel>
            <channel id="P3">
                <fullname>Parallel clock 3</fullname>
                <value>10</value>
            </channel>
            <channel id="P4">
                <fullname>Parallel clock 4</fullname>
                <value>11</value>
            </channel>
            <channel id="SPL">
                <fullname>ADC sampling signal</fullname>
                <value>12</value>
            </channel>
            <channel id="SOI">
                <fullname>Start of image</fullname>
                <value>13</value>
            </channel>
            <channel id="EOI">
                <fullname>End of image</fullname>
                <value>14</value>
            </channel>
            <channel id="RDP">
                <fullname>Calibration pulse on reset drain</fullname>
                <value>15</value>
            </channel>
        </channels>

        <functions>            
        <!-- *************************************************************** -->
        <!-- Wave-front Sensor Acquisition Mode Function Definitions         -->
        <!--                                                                 -->
        <!-- Functions are the lowest level of programming for the sequencer -->
        <!-- Functions consist of timeslices in which a set of clocks are    -->
        <!-- assigned a particular value for a defined period of time.       -->
        <!--                                                                 -->
        <!-- Functions defined for wavefront sensor operation include:       -->
        <!--   Default                                                       -->
        <!--      Defualt state  when not doing anything else                -->
        <!--   WS_Parallel_Dump                                              -->
        <!--   WS_Parallel_Discard_0 (with parallel clocks in State 0)       -->
        <!--   WS_Parallel_Discard_1 (with parallel clocks in State 1)       -->
        <!--   WS_Parallel_Discard_2 (with parallel clocks in State 2)       -->
        <!--   WS_Parlalel_Discard_3 (with parallel clocks in State 3)       -->
        <!--   WS_Parallel_Discard_4 (with parallel clocks in State 4)       -->
        <!--   WS_Parallel_Discard_5 (with parallel clocks in State 5)       -->
        <!--   WS_Serial_Discard                                             -->
        <!--   WS_Forward_Parallel_Shift                                     -->
        <!--   WS_Bin1_Pixel_Readout                                         -->
        <!--   WS_Shift_and_Ramp_Up                                          -->
        <!--   WS_Serial_Shift                                               -->
        <!--   WS_Ramp_Down_and_Convert                                      -->
        <!--   WS_Pulsed_Pixel                                               -->
        <!--   WS_Reverse_Parallel_Shift                                     -->
        <!--   WS_Reverse_Pixel_Readout                                      -->
        <!--                                                                 -->
        <!-- *************************************************************** -->

            <!-- *********************************************************** -->
            <!-- FIRST FUNCTION MUST BE THE DEFAULT STATE                    -->
            <!-- *********************************************************** -->
            <!-- Default : Default state when not operating                  -->
            <!--                                                             -->
            <function id="Default">
                <fullname>Default state when not operating</fullname>
                <clocklist>
                    <clock ref="RDP"/>   <!--  RDP - Calibration Pulse       -->
                    <clock ref="EOI"/>   <!--  EOI - End of image            -->
                    <clock ref="SOI"/>   <!--  SOI - Start of image          -->
                    <clock ref="SPL"/>   <!--  SPL - ADC sampling signal     -->
                    <clock ref="P4"/>    <!--  P4  - CCD Parallel Phase 4    -->
                    <clock ref="P3"/>    <!--  P3  - CCD Parallel Phase 3    -->
                    <clock ref="P2"/>    <!--  P2  - CCD Parallel Phase 2    -->
                    <clock ref="P1"/>    <!--  P1  - CCD Parallel Phase 1    -->
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                    <clock ref="CL"/>    <!--  CL  - ASPIC Input Clamp       -->
                    <clock ref="RST"/>   <!--  RST - ASPIC Int. Reset        --> 
                    <clock ref="RD"/>    <!--  RD  - APSIC Ramp Down         -->     
                    <clock ref="RU"/>    <!--  RU  - APSIC Ramp Up           -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>100 ns</duration>
                        <value>0000011000111000</value>
                        <!--   ||||||||||||||||_ RU  - APSIC Ramp Up         -->
                        <!--   |||||||||||||||__ RD  - APSIC Ramp Down       -->     
                        <!--   ||||||||||||||___ RST - ASPIC Int. Reset      --> 
                        <!--   |||||||||||||____ CL  - ASPIC Input Clamp     -->
                        <!--   ||||||||||||_____ R1  - Serial Phase 1        -->
                        <!--   |||||||||||______ R2  - Serial Phase 2        -->
                        <!--   ||||||||||_______ R3  - Serial Phase 3        -->
                        <!--   |||||||||________ RG  - Reset Gate            -->
                        <!--   ||||||||_________ P1  - Parallel Phase 1      -->
                        <!--   |||||||__________ P2  - Parallel Phase 2      -->
                        <!--   ||||||___________ P3  - Parallel Phase 3      -->
                        <!--   |||||____________ P4  - Parallel Phase 4      -->
                        <!--   ||||_____________ SPL - ADC sampling signal   -->
                        <!--   |||______________ SOI - Start of image        -->
                        <!--   ||_______________ EOI - End of image          -->
                        <!--   |________________ RDP - Calibration Pulse     -->
                    </timeslice>
                </slicelist>
            </function>

            <!-- *********************************************************** -->
            <!--   WS_RG_High                                                -->
            <!--                                                             -->
            <function id="WS_RG_High">
                <fullname>Set the Reset Gate to High</fullname>
                <clocklist>
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>100 ns</duration>
                        <value>1</value> 
                    </timeslice>
                </slicelist>
            </function>        

            <!-- *********************************************************** -->
            <!--   WS_RG_Low                                                 -->
            <!--                                                             -->
            <function id="WS_RG_Low">
                <fullname>Set the Reset Gate to High</fullname>
                <clocklist>
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>100 ns</duration>
                        <value>0</value> 
                    </timeslice>
                </slicelist>
            </function>        

            <!-- *********************************************************** -->
            <!--   WS_RDP_High                                               -->
            <!--                                                             -->
<!--            <function id="WS_RDP_High">
                <fullname>Set the Reset Gate to High</fullname>
                <clocklist>
                    <clock ref="RDP"/>    <!- -  RDP - Calibration Pulse      - ->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>100 ns</duration>
                        <value>1</value> 
                    </timeslice>
                </slicelist>
            </function>        
-->
            <!-- *********************************************************** -->
            <!--   WS_RDP_Low                                                -->
            <!--                                                             -->
<!--            <function id="WS_RDP_Low">
                <fullname>Set the Reset Gate to High</fullname>
                <clocklist>
                    <clock ref="RDP"/>    <!- -  RDP - Calibration Pulse      - ->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>100 ns</duration>
                        <value>0</value> 
                    </timeslice>
                </slicelist>
            </function>        
-->                        
            <!-- *********************************************************** -->
            <!--   WS_Serial_Shift                                           -->
            <!--                                                             -->

            <function id="WS_Serial_Shift">
                <fullname>Shift a pixel in the output register</fullname>
                <clocklist>
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>011</value>                 <!--      R2   R1 -->
                        <!--   |||__ R1  - Serial Phase 1                    -->
                        <!--   ||___ R2  - Serial Phase 2                    -->
                        <!--   |____ R3  - Serial Phase 3                    -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>010</value>                 <!--      R2      -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>110</value>                 <!-- R3   R2      -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>100</value>                 <!-- R3           -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>101</value>                 <!-- R3        R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>001</value>                 <!--           R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>011</value>                 <!--      R2   R1 -->
                    </timeslice>
                </slicelist>
            </function>        
            
            <!-- *********************************************************** -->
            <!--   WS_Serial_Reverse_Shift                                   -->
            <!--                                                             -->
            <function id="WS_Serial_Reverse_Shift">
                <fullname>Shift the serial register backwards</fullname>
                <clocklist>
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>011</value>                 <!--      R2   R1 -->
                        <!--   |||__ R1  - Serial Phase 1                    -->
                        <!--   ||___ R2  - Serial Phase 2                    -->
                        <!--   |____ R3  - Serial Phase 3                    -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>001</value>                 <!--           R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>011</value>                 <!-- R3        R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>100</value>                 <!-- R3           -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>110</value>                 <!-- R3   R2      -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>010</value>                 <!--      R2      -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>011</value>                 <!--      R2   R1 -->
                    </timeslice>
                </slicelist>
            </function>        
            
            <!-- *********************************************************** -->
            <!--   WS_Serial_Discard                                         -->
            <!--                                                             -->

            <function id="WS_Serial_Discard">
                <fullname>Discard a pixel from the output register</fullname>
                <clocklist>
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>0010</value>               <!--        R2  R1 -->
                        <!--   ||||__ R1  - Serial Phase 1                   -->
                        <!--   |||___ R2  - Serial Phase 2                   -->
                        <!--   ||____ R3  - Serial Phase 3                   -->
                        <!--   |_____ RG  - Reset Gate                       -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>0110</value>               <!--    R3  R2     -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>0100</value>               <!--    R3         -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>0101</value>               <!--    R3      R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>0001</value>               <!-- RG         R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>1001</value>               <!-- RG         R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>SerDelay</duration>
                        <value>1011</value>               <!--        R2  R1 -->
                    </timeslice>
                </slicelist>
            </function>
           
            <!-- *********************************************************** -->
            <!--   WS_Parallel_Shift                                         -->
            <!--                                                             -->

            <function id="WS_Forward_Parallel_Shift">
                <fullname>Forward shift from image array to output register</fullname>
                <clocklist>
                    <clock ref="P4"/>    <!--  P4  - CCD Parallel Phase 4    -->
                    <clock ref="P3"/>    <!--  P3  - CCD Parallel Phase 3    -->
                    <clock ref="P2"/>    <!--  P2  - CCD Parallel Phase 2    -->
                    <clock ref="P1"/>    <!--  P1  - CCD Parallel Phase 1    -->
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>01101011</value>  <!--    P3 P2    RG   R2 R1 -->
                        <!--   ||||||||__ R1  - Serial Phase 1               -->
                        <!--   |||||||___ R2  - Serial Phase 2               -->
                        <!--   ||||||____ R3  - Serial Phase 3               -->
                        <!--   |||||_____ RG  - Reset Gate                   -->
                        <!--   ||||______ P1  - Parallel Phase 1             -->
                        <!--   |||_______ P2  - Parallel Phase 2             -->
                        <!--   ||________ P3  - Parallel Phase 3             -->
                        <!--   |_________ P4  - Parallel Phase 4             -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>11101011</value> <!-- P4 P3 P2    RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>11001011</value> <!-- P4 P3       RG    R2 R1 -->
                    </timeslice>
                   <timeslice>
                        <duration>ParDelay</duration>
                        <value>11011011</value> <!-- P4 P3    P1 RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>10011011</value> <!-- P4       P1 RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>10111011</value> <!-- P4    P2 P1 RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>00111011</value> <!--       P2 P1 RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>01111011</value> <!--    P3 P2 P1 RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>01101011</value> <!--    P3 P2    RG    R2 R1 -->
                    </timeslice>
                </slicelist>
            </function>
            
            <!-- *********************************************************** -->
            <!--   WS_Reverse_Parallel_Shift                                 -->
            <!--                                                             -->
            <function id="WS_Reverse_Parallel_Shift">
                <fullname>Reverse shift a row in the image array</fullname>
                <clocklist>
                    <clock ref="P4"/>    <!--  P4  - CCD Parallel Phase 4    -->
                    <clock ref="P3"/>    <!--  P3  - CCD Parallel Phase 3    -->
                    <clock ref="P2"/>    <!--  P2  - CCD Parallel Phase 2    -->
                    <clock ref="P1"/>    <!--  P1  - CCD Parallel Phase 1    -->
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>01101011</value>    <!-- P3,P2,  ,RG,  ,R2,R1 -->
                        <!--   ||||||||__ R1  - Serial Phase 1               -->
                        <!--   |||||||___ R2  - Serial Phase 2               -->
                        <!--   ||||||____ R3  - Serial Phase 3               -->
                        <!--   |||||_____ RG  - Reset Gate                   -->
                        <!--   ||||______ P1  - Parallel Phase 1             -->
                        <!--   |||_______ P2  - Parallel Phase 2             -->
                        <!--   ||________ P3  - Parallel Phase 3             -->
                        <!--   |_________ P4  - Parallel Phase 4             -->
                    </timeslice>                <!-- P4 P3 P2 P1 RG R3 R2 R1 -->
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>01111011</value> <!--    P3 P2 P1 RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>00111011</value> <!--       P2 P1 RG    R2 R1 -->
                    </timeslice>
                   <timeslice>
                        <duration>ParDelay</duration>
                        <value>10111011</value> <!-- P4    P2 P1 RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>10011011</value> <!-- P4       P1 RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>11011011</value> <!-- P4 P3    P1 RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>11001011</value> <!-- P4 P3       RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>11101011</value> <!-- P4 P3 P2    RG    R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>01101011</value> <!--    P3 P2    RG    R2 R1 -->
                    </timeslice>
                </slicelist>
            </function>
            

            <!-- *********************************************************** -->
            <!-- WS_Parallel_Dump : dump a row into the serial register      -->
            <!--     while holding the serials and reset gate high.          -->
            <!--                                                             -->
            <function id="WS_Parallel_Dump">
                <fullname>Discard a row from the image array</fullname>
                <clocklist>
                    <clock ref="P4"/>    <!--  P4  - CCD Parallel Phase 4    -->
                    <clock ref="P3"/>    <!--  P3  - CCD Parallel Phase 3    -->
                    <clock ref="P2"/>    <!--  P2  - CCD Parallel Phase 2    -->
                    <clock ref="P1"/>    <!--  P1  - CCD Parallel Phase 1    -->
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>01101111</value> <!--    P3 P2    RG R3 R2 R1 -->
                        <!--   ||||||||__ R1  - Serial Phase 1               -->
                        <!--   |||||||___ R2  - Serial Phase 2               -->
                        <!--   ||||||____ R3  - Serial Phase 3               -->
                        <!--   |||||_____ RG  - Reset Gate                   -->
                        <!--   ||||______ P1  - Parallel Phase 1             -->
                        <!--   |||_______ P2  - Parallel Phase 2             -->
                        <!--   ||________ P3  - Parallel Phase 3             -->
                        <!--   |_________ P4  - Parallel Phase 4             -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>11101111</value> <!-- P4 P3 P2    RG R3 R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>11001111</value> <!-- P4 P3       RG R3 R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>11011111</value> <!-- P4 P3    P1 RG R3 R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>10011111</value> <!-- P4       P1 RG R3 R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>10111111</value> <!-- P4    P2 P1 RG R3 R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>00111111</value> <!--       P2 P1 RG R3 R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>01111111</value> <!--    P3 P2 P1 RG R3 R2 R1 -->
                    </timeslice>
                    <timeslice>
                        <duration>ParDelay</duration>
                        <value>01101111</value> <!--    P3 P2    RG R3 R2 R1 -->
                    </timeslice>
               </slicelist>
            </function>

        
            <!-- *********************************************************** -->
            <!--   WS_Bin1_Pixel_Readout                                     -->
            <!--                                                             -->
            <function id="WS_Bin1_Pixel_Readout">
                <fullname>Read a pixel using binning factor of one</fullname>
                <clocklist>
                    <clock ref="RDP"/>   <!--  RDP - Calibration Pulse       -->
                    <clock ref="SPL"/>   <!--  SPL - ADC sampling signal     -->
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                    <clock ref="CL"/>    <!--  CL  - ASPIC Input Clamp       -->
                    <clock ref="RST"/>   <!--  RST - ASPIC Int. Reset        --> 
                    <clock ref="RD"/>    <!--  RD  - APSIC Ramp Down         -->     
                    <clock ref="RU"/>    <!--  RU  - APSIC Ramp Up           -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>ReadDelay1</duration>
                        <value>1000111100</value> <!--           R2 R1 CL RST -->
                        <!--   	|||||||||_ RU  - APSIC Ramp Up                -->
                        <!--   	||||||||__ RD  - APSIC Ramp Down              -->     
                        <!--   	|||||||___ RST - ASPIC Int. Reset             --> 
                        <!--   	||||||____ CL  - ASPIC Input Clamp            -->
                        <!--   	|||||_____ R1  - Serial Phase 1               -->
                        <!--   	||||______ R2  - Serial Phase 2               -->
                        <!--   	|||_______ R3  - Serial Phase 3               -->
                        <!--   	||________ RG  - Reset Gate                   -->
                        <!--   	|_________ SPL - ADC sampling signal          -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay2</duration>
                        <value>1010101100</value> <!--     RG    R2    CL RST -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay3</duration>
                        <value>1011101100</value> <!--     RG R3 R2    CL RST -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay4</duration>
                        <value>0011000100</value> <!--     RG R3       CL     -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay5</duration>
                        <value>0001000000</value> <!--        R3              -->
                    </timeslice>
                    <timeslice>
                        <duration>RampDelay</duration>
                        <value>0001000001</value> <!--        R3           RU -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay6</duration>
                        <value>0001000000</value> <!--        R3              -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay7</duration>
                        <value>0001010000</value> <!--        R3    R1        -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay8</duration>
                        <value>0000010000</value> <!--              R1        -->
                    </timeslice>
                    <timeslice>
                        <duration>RampDelay</duration>
                        <value>0000010010</value> <!--              R1     RD -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay9</duration>
                        <value>0000010000</value> <!--              R1        -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay10</duration>
                        <value>0000110000</value> <!--           R2 R1        -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay11</duration>
                        <value>0100110000</value> <!-- SPL       R2 R1        -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay12</duration>
                        <value>1000110000</value> <!--           R2 R1        -->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay13</duration>
                        <value>1000110000</value> <!--           R2 R1        -->
                    </timeslice>
               </slicelist>
            </function>


            <!-- *********************************************************** -->
            <!--   WS_Shift_and_Ramp_Up                                      -->
<!--
            <function id="WS_Shift_and_Ramp_Up">
                <fullname>Shift and Ramp Up</fullname>
                <clocklist>
                    <clock ref="SPL"/>   <!--  SPL - ADC sampling signal     -->
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                    <clock ref="CL"/>    <!--  CL  - ASPIC Input Clamp       -->
                    <clock ref="RST"/>   <!--  RST - ASPIC Int. Reset        --> 
                    <clock ref="RD"/>    <!--  RD  - APSIC Ramp Down         -->     
                    <clock ref="RU"/>    <!--  RU  - APSIC Ramp Up           -->
               </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>ReadDelay1</duration>
                        <value>000111100</value> <!- -           R2 R1 CL RST - ->
                        <!- -  |||||||||_ RU  - APSIC Ramp Up                - ->
                        <!- -  ||||||||__ RD  - APSIC Ramp Down              - ->     
                        <!- -  |||||||___ RST - ASPIC Int. Reset             - -> 
                        <!- -  ||||||____ CL  - ASPIC Input Clamp            - ->
                        <!- -  |||||_____ R1  - Serial Phase 1               - ->
                        <!- -  ||||______ R2  - Serial Phase 2               - ->
                        <!- -  |||_______ R3  - Serial Phase 3               - ->
                        <!- -  ||________ RG  - Reset Gate                   - ->
                        <!- -  |_________ SPL - ADC sampling signal          - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay2</duration>
                        <value>010101100</value> <!- -     RG    R2    CL RST - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay3</duration>
                        <value>011101100</value> <!- -     RG R3 R2    CL RST - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay4</duration>
                        <value>011001000</value> <!- -     RG R3       CL     - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay5</duration>
                        <value>001000000</value> <!- -        R3              - ->
                    </timeslice>
                    <timeslice>
                        <duration>RampDelay</duration>
                        <value>001000001</value> <!- -        R3           RU - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay6</duration>
                        <value>001000000</value> <!- -        R3              - ->
                    </timeslice>
               </slicelist>
            </function>
-->            
            <!-- *********************************************************** -->
            <!--   WS_Ramp_Down_and_Convert                                  -->
<!--            
            <function id="WS_Ramp_Down_and_Convert">
                <fullname>Ramp Down and Convert</fullname>
                <clocklist>
                    <clock ref="SPL"/>   <!--  SPL - ADC sampling signal     -->
                    <clock ref="RG"/>    <!--  RG  - CCD Reset Gate          -->
                    <clock ref="R3"/>    <!--  R3  - CCD Serial Phase 3      -->
                    <clock ref="R2"/>    <!--  R2  - CCD Serial Phase 2      -->
                    <clock ref="R1"/>    <!--  R1  - CCD Serial Phase 1      -->
                    <clock ref="CL"/>    <!--  CL  - ASPIC Input Clamp       -->
                    <clock ref="RST"/>   <!--  RST - ASPIC Int. Reset        --> 
                    <clock ref="RD"/>    <!--  RD  - APSIC Ramp Down         -->     
                    <clock ref="RU"/>    <!--  RU  - APSIC Ramp Up           -->
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>ReadDelay7</duration>
                        <value>001010000</value> <!- -        R3    R1        - ->
                        <!- -  |||||||||_ RU  - APSIC Ramp Up                - ->
                        <!- -  ||||||||__ RD  - APSIC Ramp Down              - ->     
                        <!- -  |||||||___ RST - ASPIC Int. Reset             - -> 
                        <!- -  ||||||____ CL  - ASPIC Input Clamp            - ->
                        <!- -  |||||_____ R1  - Serial Phase 1               - ->
                        <!- -  ||||______ R2  - Serial Phase 2               - ->
                        <!- -  |||_______ R3  - Serial Phase 3               - ->
                        <!- -  ||________ RG  - Reset Gate                   - ->
                        <!- -  |_________ SPL - ADC sampling signal          - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay8</duration>
                        <value>000010000</value> <!- -              R1        - ->
                    </timeslice>
                    <timeslice>
                        <duration>RampDelay</duration>
                        <value>000010010</value> <!- -              R1     RD - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay9</duration>
                        <value>000010000</value> <!- -              R1        - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay10</duration>
                        <value>000110000</value> <!- -           R2 R1        - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay11</duration>
                        <value>100110000</value> <!- - SPL       R2 R1        - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay12</duration>
                        <value>000110000</value> <!- -           R2 R1        - ->
                    </timeslice>
                    <timeslice>
                        <duration>ReadDelay13</duration>
                        <value>000110000</value> <!- -           R2 R1        - ->
                    </timeslice>
               </slicelist>
            </function>    
-->                    
            <!-- *********************************************************** -->
            <!--   WS_Pulsed_Pixel                                           -->
            

            
            <!-- *********************************************************** -->
            <!--   WS_Reverse_Pixel_Readout                                  -->
            <!-- *********************************************************** -->
            
        <!-- *************************************************************** -->
        <!-- Generic Functions (same for all sensors)                        -->
        <!--                                                                 -->
        <!-- *************************************************************** -->

            <!-- Start of Image: signal that data is going to be generated   -->
            <function id="StartImage">
                <fullname>"Start of Image"</fullname>
                <clocklist>
                    <clock ref="SOI"/>
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>100 ns</duration>
                        <value>1</value>
                    </timeslice>
                    <timeslice>
                        <duration>10 ns</duration>
                        <value>0</value>
                    </timeslice>
                </slicelist>
                <constants/>
            </function>
            
            <!-- End of Image: signal that data is generation is finished   -->
            <function id="EndImage">
                <fullname>"End of Image"</fullname>
                <clocklist>
                    <clock ref="EOI"/>
                </clocklist>
                <slicelist>
                    <timeslice>
                        <duration>2000 ns</duration>
                        <value>0</value>
                    </timeslice>
                    <timeslice>
                        <duration>100 ns</duration>
                        <value>1</value>
                    </timeslice>
                    <timeslice>
                        <duration>10 ns</duration>
                        <value>0</value>
                    </timeslice>
                </slicelist>
                <constants/>
            </function>

            
        </functions> <!-- End of function definitions -->
    </sequencer-config> <!-- End of sequencer configuration -->

    <!-- ******************************************************************* -->
    <!--  Sequencer Routines                                                 -->
    <!--  Functions are combined into 'subroutines'                          -->
    <!--                                                                     -->
    <!--  ClearRow : Flush a single row off the CCD                          -->
    <!--  ClearFast : Flush the entire image array once, FAST                -->
    <!--  ClearSlow : Flush the entire image array, SLOWLY                   -->
    <!--  ReadRow : read a row of pixels                                     -->
    <!--  ReadArrayRow : Read a row as part of a subarray readout            -->
    <!--        Shift a row into the output register, discard PreColumns     -->  
    <!--        pixels, read ReadColumns pixels, and discard PostColumns     -->
    <!--        pixels.                                                      -->                   
    <!-- ReadArray : Read some of the pixels on the CCD                      -->
    <!-- ReadCCD : Read all the pixels on the CCD                            -->
    <!-- RunCCD : Clear and then read the CCD                                -->
    <!--                                                                     -->
    <!-- ******************************************************************* -->
    
    <sequencer-routines>
        <subroutines>
 
            <subroutine id="ClearRow">
                <fullname>Flush a single row off the CCD</fullname>            
                <call ref="WS_Parallel_Forward_Shift"/>
                <call ref="WS_RG_High"/>
                <call ref="WS_Serial_Shift">
                    <repeat>SegColumns</repeat>
                </call>
                <call ref="WS_RG_Low"/>
            </subroutine>
       
            <subroutine id="ClearFast">
                <fullname>Flush the entire image array once, FAST</fullname>            
                <call ref="WS_Parallel_Dump">
                    <repeat>SegRows</repeat>
                </call>
                <call ref="ClearRow"/>  <!-- one last register flush -->
            </subroutine>

            <subroutine id="ClearSlow">
                <fullname>Flush the entire image array, SLOWLY</fullname>            
                <call ref="ClearRow">
                    <repeat>SegRows</repeat>
                </call>
            </subroutine>


            <subroutine id="ReadRow">
                <call ref="WS_Forward_Parallel_Shift"/>
                <call ref="WS_Bin1_Pixel_Readout">
                    <repeat>SegColumns</repeat>
                </call>
            </subroutine>
 
            <subroutine id="ReadArrayRow">
                <call ref="WS_Forward_Parallel_Shift"/>
                <call ref="WS_Serial_Discard">
                    <repeat>PreColumns</repeat>
                </call>
                <call ref="WS_Bin1_Pixel_Readout">
                    <repeat>ReadColumns</repeat>
                </call>
                <call ref="WS_Serial_Discard">
                    <repeat>PostColumns</repeat>
                </call>
            </subroutine>     

            
            <subroutine id="ReadArray">
                <!-- <call ref="StartImage"/>  -->
                <call ref="ClearRow">
                    <repeat>PreRows</repeat>
                </call>
                <call ref="ReadArrayRow">
                    <repeat>ReadRows</repeat>
                </call>
                <call ref="ClearRow">
                    <repeat>PostRows</repeat>
                </call>
                <!-- <call ref="EndImage"/>  -->
            </subroutine>     


            <subroutine id="ReadCCD">
                <call ref="StartImage"/>
                <call ref="ReadRow">
                    <repeat>SegRows</repeat>
                </call>
                <call ref="EndImage"/>
            </subroutine>  

    
            <subroutine id="RunCCD">
                <call ref="ClearSlow"/>
                <call ref="WS_RDP_High"/>
                <call ref="ReadCCD"/>
                <call ref="WS_RDP_Low"/>
            </subroutine>  

        </subroutines>   <!-- End of Subroutine definitions -->

        <!-- *********************************************************** -->
        <!--  Main                                                       -->
        <!--  Top level operation                                        -->
        <!-- *********************************************************** -->
        <mains>
            <main id="Main">
                <fullname>Top level for WFS operation</fullname>
                <call ref="ReadCCD"/>
            </main>
        </mains>
    </sequencer-routines>  <!-- End of Sequencer Routines -->
</sequencer>  <!-- EOF -->
